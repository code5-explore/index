<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title> Attendance Register</title>
<style>
  body {
    background-color: grey;
    margin: 0;
    padding: 1rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    max-width: 350px;
    height: 600px;
    overflow: hidden;
  }
  h1 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid white;
    padding: 5px 3px;
    text-align: center;
    vertical-align: middle;
  }
  input[type="text"] {
    width: 90%;
    border-radius: 3px;
    border: none;
    padding: 3px 5px;
    font-size: 0.9rem;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  #download-btn {
    display: block;
    margin: 10px auto 0;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: white;
    color: red;
    cursor: pointer;
    width: 100%;
    max-width: 320px;
  }
  #download-btn:hover {
    background: #ddd;
  }
  /* Make the table wrap on mobile */
  div.table-container {
    overflow-x: auto;
    max-height: 520px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython_stdlib.min.js"></script>
</head>
<body onload="brython()">
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Attendance Register</title>
<style>
  body {
    background-color: grey;
    margin: 0;
    padding: 1rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  h1 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  .info-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 1rem;
  }
  .info-form label {
    font-weight: bold;
    font-size: 0.9rem;
  }
  input[type="text"], input[type="number"] {
    width: 95%;
    border-radius: 3px;
    border: none;
    padding: 5px;
    font-size: 0.9rem;
  }
  .generate-btn {
    grid-column: 1 / -1;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid white;
    padding: 5px 3px;
    text-align: center;
    vertical-align: middle;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  #download-btn {
    display: block;
    margin: 10px auto 0;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: white;
    color: red;
    cursor: pointer;
    width: 100%;
  }
  #download-btn:hover { background: #ddd; }
  div.table-container {
    overflow-x: auto;
    max-height: 450px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython_stdlib.min.js"></script>
</head>
<body onload="brython()">
<h1>Attendance Register</h1>

<div class="info-form">
  <label for="teacher-name">Name:</label>
  <input type="text" id="teacher-name" value="Babatunde Oladejo">
  
  <label for="record-info">Record Period:</label>
  <input type="text" id="record-info" value="Week 5 / June / 2025">

  <label for="num-students">Number of Students:</label>
  <input type="number" id="num-students" value="10" min="1" max="50">

  <button id="generate-btn" class="generate-btn">Generate / Clear Table</button>
</div>

<div class="table-container">
<table id="register-table" aria-label="Student attendance register">
  <thead>
    <tr>
      <th style="width:120px;">Name</th>
      <th>Mon</th>
      <th>Tue</th>
      <th>Wed</th>
      <th>Thu</th>
      <th>Fri</th>
      <th style="width:40px;">Total</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <!-- Rows will be generated by Brython -->
  </tbody>
</table>
</div>
<button id="download-btn">Download Excel</button>

<script type="text/python">
from browser import document, html, window, local_storage
import json ## NEW: Import the json library

WEEKDAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']
STORAGE_KEY = 'attendanceRegisterState' ## NEW: A key for localStorage
num_students = 0

## NEW: Function to save the entire table state to localStorage
def save_state():
    global num_students
    state = {
        'teacher_name': document['teacher-name'].value,
        'record_info': document['record-info'].value,
        'num_students': document['num-students'].value,
        'students': []
    }
    for i in range(num_students):
        student_data = {
            'name': document[f'{i}_name'].value,
            'attendance': {}
        }
        for day in WEEKDAYS:
            student_data['attendance'][day] = document[f'{i}_cb_{day}'].checked
        state['students'].append(student_data)
    
    local_storage.storage[STORAGE_KEY] = json.dumps(state)

## NEW: Function to load the state from localStorage
def load_state():
    if STORAGE_KEY in local_storage.storage:
        state = json.loads(local_storage.storage[STORAGE_KEY])
        
        # Restore header info
        document['teacher-name'].value = state.get('teacher_name', '')
        document['record-info'].value = state.get('record_info', '')
        document['num-students'].value = state.get('num_students', 10)
        
        # Generate table based on saved number of students
        generate_table(None) 
        
        # Populate the generated table with saved data
        for i, student_data in enumerate(state.get('students', [])):
            if i < num_students: # Make sure we don't go out of bounds
                document[f'{i}_name'].value = student_data.get('name', f'Student {i+1}')
                for day, is_checked in student_data.get('attendance', {}).items():
                    document[f'{i}_cb_{day}'].checked = is_checked
                calculate_total(i) # Update the total count for the row

    else:
        # If no saved state, just generate a default table
        generate_table(None)

def calculate_total(row_index):
    total = 0
    for day in WEEKDAYS:
        checkbox = document[f'{row_index}_cb_{day}']
        if checkbox.checked:
            total += 1
    total_cell = document[f'{row_index}_total']
    total_cell.text = str(total)

def on_input_change(ev):
    ## NEW: This handler now covers both checkboxes and text inputs
    checkbox = ev.target
    row_index = checkbox.id.split('_')[0]
    # Check if the changed element was a checkbox to calculate total
    if 'cb' in checkbox.id:
        calculate_total(row_index)
    save_state() # Save state on any change

def create_row(index):
    row_id = str(index)
    tr = html.TR()
    
    name_input = html.INPUT(type="text", id=f'{row_id}_name', value=f'Student {index+1}')
    ## NEW: Bind the 'input' event on the name field to save changes as user types
    name_input.bind('input', on_input_change)
    tr <= html.TD(name_input)

    for day in WEEKDAYS:
        cb = html.INPUT(type="checkbox", id=f'{row_id}_cb_{day}')
        ## NEW: Use the unified 'on_input_change' handler
        cb.bind('change', on_input_change)
        tr <= html.TD(cb)

    tr <= html.TD('0', id=f'{row_id}_total')
    return tr

def generate_table(ev):
    global num_students
    ## NEW: If called by button click, clear the storage for a "fresh start"
    if ev is not None:
        local_storage.storage.pop(STORAGE_KEY, None)
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Attendance Register</title>
<style>
  body {
    background-color: grey;
    margin: 0;
    padding: 1rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  h1 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  .info-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 1rem;
  }
  .info-form label {
    font-weight: bold;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
  }
  input[type="text"], input[type="number"] {
    width: 95%;
    border-radius: 3px;
    border: none;
    padding: 5px;
    font-size: 0.9rem;
  }
  .generate-btn {
    grid-column: 1 / -1;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid white;
    padding: 5px 3px;
    text-align: center;
    vertical-align: middle;
  }
  input[type="text"]#student-name {
    width: 90%;
    border-radius: 3px;
    border: none;
    padding: 3px 5px;
    font-size: 0.9rem;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    vertical-align: middle;
  }
  #download-btn {
    display: block;
    margin: 15px auto 0;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: white;
    color: red;
    cursor: pointer;
    width: 100%;
  }
  #download-btn:hover { background: #ddd; }
  div.table-container {
    overflow-x: auto;
    max-height: 450px; /* Adjusted for better layout */
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython_stdlib.min.js"></script>
</head>
<body onload="brython()">
<h1>Attendance Register</h1>

<div class="info-form">
  <label for="teacher-name">Name:</label>
  <input type="text" id="teacher-name" value="Babatunde Oladejo">
  
  <label for="record-info">Record Period:</label>
  <input type="text" id="record-info" value="Week 5 / June / 2025">

  <label for="num-students">Number of Students:</label>
  <input type="number" id="num-students" value="8" min="1" max="50">

  <button id="generate-btn" class="generate-btn">Clear Table</button>
</div>

<div class="table-container">
<table id="register-table" aria-label="Student attendance register">
  <thead>
    <tr>
      <th style="width:120px;">Name</th>
      <th>Mon</th>
      <th>Tue</th>
      <th>Wed</th>
      <th>Thu</th>
      <th>Fri</th>
      <th style="width:40px;">Total</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <!-- Rows will be generated by Brython -->
  </tbody>
</table>
</div>
<button id="download-btn">Download CSV</button>

<script type="text/python">
from browser import document, html, window, local_storage
import json

WEEKDAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']
STORAGE_KEY = 'attendanceRegisterState'
num_students = 0

def save_state(ev=None):
    """Saves the entire form and table state to localStorage."""
    global num_students
    state = {
        'teacher_name': document['teacher-name'].value,
        'record_info': document['record-info'].value,
        'num_students': document['num-students'].value,
        'students': []
    }
    
    # Ensure num_students is up-to-date before saving table data
    try:
        num_students = int(document['num-students'].value)
    except (ValueError, TypeError):
        num_students = 0

    for i in range(num_students):
        # Check if the element exists before accessing it
        if f'{i}_name' in document:
            student_data = {
                'name': document[f'{i}_name'].value,
                'attendance': {}
            }
            for day in WEEKDAYS:
                student_data['attendance'][day] = document[f'{i}_cb_{day}'].checked
            state['students'].append(student_data)
    
    local_storage.storage[STORAGE_KEY] = json.dumps(state)

def load_state():
    """Loads the state from localStorage on page load."""
    if STORAGE_KEY in local_storage.storage:
        state = json.loads(local_storage.storage[STORAGE_KEY])
        
        document['teacher-name'].value = state.get('teacher_name', '')
        document['record-info'].value = state.get('record_info', '')
        document['num-students'].value = state.get('num_students', 8)
        
        generate_table(None) 
        
        students_data = state.get('students', [])
        for i, student_data in enumerate(students_data):
            if i < num_students:
                document[f'{i}_name'].value = student_data.get('name', f'Student {i+1}')
                for day, is_checked in student_data.get('attendance', {}).items():
                    if f'{i}_cb_{day}' in document:
                        document[f'{i}_cb_{day}'].checked = is_checked
                calculate_total(i)
    else:
        generate_table(None)

def calculate_total(row_index):
    """Calculates and updates the total for a given student row."""
    total = 0
    for day in WEEKDAYS:
        checkbox = document[f'{row_index}_cb_{day}']
        if checkbox.checked:
            total += 1
    total_cell = document[f'{row_index}_total']
    total_cell.text = str(total)

def on_input_change(ev):
    """Unified handler for changes in name inputs and checkboxes."""
    checkbox = ev.target
    row_index = int(checkbox.id.split('_')[0])
    if 'cb' in checkbox.id:
        calculate_total(row_index)
    save_state()

def create_row(index):
    """Creates a single row for the attendance table."""
    row_id = str(index)
    tr = html.TR()
    
    name_input = html.INPUT(type="text", id=f'{row_id}_name', value=f'Student {index+1}')
    name_input.bind('input', on_input_change)
    td_name = html.TD(name_input)
    td_name.select_one('input').id = 'student-name' # Apply specific style if needed
    tr <= td_name

    for day in WEEKDAYS:
        cb = html.INPUT(type="checkbox", id=f'{row_id}_cb_{day}')
        cb.bind('change', on_input_change)
        tr <= html.TD(cb)

    tr <= html.TD('0', id=f'{row_id}_total')
    return tr

def generate_table(ev):
    """Generates a new table or clears the existing one."""
    global num_students
    
    # If called by button click, clear storage for a "fresh start"
    if ev is not None:
        local_storage.storage.pop(STORAGE_KEY, None)
        document['teacher-name'].value = "Babatunde Oladejo" # Reset defaults
        document['record-info'].value = "Week 5 / June / 2025"
        # Reset number of students to default if cleared
        document['num-students'].value = 8
    
    try:
        num_students = int(document['num-students'].value)
        if num_students > 50: # Cap at max
            num_students = 50
            document['num-students'].value = 50
    except (ValueError, TypeError):
        num_students = 8
    
    tbody = document['table-body']
    tbody.clear()
    for i in range(num_students):
        tr = create_row(i)
        tbody <= tr

    # After generating a fresh table, save its initial state
    if ev is not None:
        save_state()

def download_csv(ev):
    """Gathers data from the DOM and downloads it as a CSV file."""
    rows = []
    teacher_name = document['teacher-name'].value.strip()
    record_info = document['record-info'].value.strip()
    rows.append([f"Name: {teacher_name}"])
    rows.append([f"Record Period: {record_info}"])
    rows.append([])
    
    header = ['Name'] + WEEKDAYS + ['Total Attendance']
    rows.append(header)

    for i in range(num_students):
        row_id = str(i)
        name = document[f'{row_id}_name'].value.strip() or f"Student {i+1}"
        attendance = ['Present' if document[f'{row_id}_cb_{day}'].checked else 'Absent' for day in WEEKDAYS]
        total = document[f'{row_id}_total'].text
        rows.append([name] + attendance + [total])
        
    csv_text = '\r\n'.join([','.join([f'"{str(col).replace("\"", "\"\"")}"' for col in row]) for row in rows])

    blob = window.Blob.new([csv_text], { "type": "text/csv;charset=utf-8;" })
    url = window.URL.createObjectURL(blob)
    a = document.createElement('a')
    a.href = url
    a.download = 'attendance_register.csv'
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    window.URL.revokeObjectURL(url)

def main():
    """Main function to bind events and initialize the application."""
    document['generate-btn'].bind('click', generate_table)
    document['download-btn'].bind('click', download_csv)
    
    # Bind top input fields to save state on change
    document['teacher-name'].bind('input', save_state)
    document['record-info'].bind('input', save_state)
    # The 'Clear' button is the primary way to reset the table
    # A user changing the number should click the button to see the effect
    document['num-students'].bind('change', save_state) 

    load_state()

main()
</script>
</body>
</html>




