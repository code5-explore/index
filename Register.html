<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title> Attendance Register</title>
<style>
  body {
    background-color: grey;
    margin: 0;
    padding: 1rem;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    max-width: 350px;
    height: 600px;
    overflow: hidden;
  }
  h1 {
    text-align: center;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid white;
    padding: 5px 3px;
    text-align: center;
    vertical-align: middle;
  }
  input[type="text"] {
    width: 90%;
    border-radius: 3px;
    border: none;
    padding: 3px 5px;
    font-size: 0.9rem;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  #download-btn {
    display: block;
    margin: 10px auto 0;
    padding: 8px 15px;
    font-size: 1rem;
    font-weight: bold;
    border: none;
    border-radius: 5px;
    background: white;
    color: red;
    cursor: pointer;
    width: 100%;
    max-width: 320px;
  }
  #download-btn:hover {
    background: #ddd;
  }
  /* Make the table wrap on mobile */
  div.table-container {
    overflow-x: auto;
    max-height: 520px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/brython@3.10.5/brython_stdlib.min.js"></script>
</head>
<body onload="brython()">
<h1>Attendance Register </h1>
  <p> Name: Babatunde Oladejo <br> Record Week/Month/Year: 5/June/2025 </p>
<div class="table-container">
<table id="register-table" aria-label="Student attendance register">
  <thead>
    <tr>
      <th style="width:120px;">Name</th>
      <th>Mon</th>
      <th>Tue</th>
      <th>Wed</th>
      <th>Thu</th>
      <th>Fri</th>
      <th style="width:30px;">Total</th>
    </tr>
  </thead>
  <tbody id="table-body">
    <!-- Rows will be generated by Brython -->
  </tbody>
</table>
</div>
<button id="download-btn">Download Excel</button>

<script type="text/python">
from browser import document, html, window

WEEKDAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri']

def calculate_total(row):
    total = 0
    for day in WEEKDAYS:
        checkbox = document[f'{row}_cb_{day}']
        if checkbox.checked:
            total += 1
    total_cell = document[f'{row}_total']
    total_cell.text = str(total)

def on_checkbox_change(ev):
    checkbox = ev.target
    # checkbox id example: 3_cb_Mon
    row = checkbox.id.split('_')[0]
    calculate_total(row)

def create_row(index):
    row_id = str(index)
    tr = html.TR()
    # Name input cell
    name_input = html.INPUT(type="text", id=f'{row_id}_name', value=f'Student {index+1}')
    td_name = html.TD(name_input)
    tr <= td_name

    # Weekday checkboxes cells
    for day in WEEKDAYS:
        cb = html.INPUT(type="checkbox", id=f'{row_id}_cb_{day}')
        cb.bind('change', on_checkbox_change)
        td_cb = html.TD(cb)
        tr <= td_cb

    # Total attendance cell
    td_total = html.TD('0', id=f'{row_id}_total')
    tr <= td_total
    return tr

def download_csv(ev):
    rows = []
    # Header row
    header = ['Name'] + WEEKDAYS + ['Total Attendance']
    rows.append(header)
    for i in range(10):
        row_id = str(i)
        name = document[f'{row_id}_name'].value.strip()
        attendance = []
        total = 0
        for day in WEEKDAYS:
            cb = document[f'{row_id}_cb_{day}']
            present = 'Yes' if cb.checked else 'No'
            attendance.append(present)
            if cb.checked:
                total += 1
        data_row = [name] + attendance + [str(total)]
        rows.append(data_row)
    # Convert to CSV text
    csv_text = ''
    for row in rows:
        # Escape commas by quotes
        escaped = [f'"{col}"' if ',' in col else col for col in row]
        csv_text += ','.join(escaped) + '\r\n'

    # Create a blob and download using JS
    blob = window.Blob.new([csv_text], { "type": "text/csv;charset=utf-8;" })
    url = window.URL.createObjectURL(blob)
    a = document.createElement('a')
    a.href = url
    a.download = 'student_register.csv'
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    window.URL.revokeObjectURL(url)

def main():
    tbody = document['table-body']
    for i in range(10):
        tr = create_row(i)
        tbody <= tr
    # Attach download button event
    document['download-btn'].bind('click', download_csv)

main()
</script>
</body>
</html>


